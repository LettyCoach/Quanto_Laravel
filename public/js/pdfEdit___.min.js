function updateTextView(t){var e=getNumber(t.val());0==e?t.val("0"):t.val(e.toLocaleString())}var uMethodDivCss=300,uMethodCss=200,uNameCss=175,uNameDivCss=220,ic_link_url=$("#ic_link").attr("src"),iHtml="";function uDiv(){$("#uMethod").css("width",uMethodCss),$("#uMethodDiv").css("width",uMethodDivCss),$("#uName").css("min-width",uNameCss),$("#uNameDiv").css("min-width",uNameDivCss)}answers.forEach(t=>{t=$("#hostUrl").val()+"/"+t.file_url;iHtml+='<div class="img-view-item"><div class="img-item-img"><input type="hidden" id="img_upload_url_1" value="'+t+'"><img src="'+t+'" style="width:190px; height: 190px;"></div><div class="img-upload-link-btn-1"><img src="'+ic_link_url+'" style="height: 50px;"></div></div>'}),resize_main_title($('[id^="purpose_"]')),$("#img_view").append(iHtml);var current_img_index="";function resize_in(t){make_html_page(t),css_re()}function css_re(){var t=parseInt($("#select_resize").val()),e=(38+22*(15-t)/7).toString()+"px",t=(45+25*(15-t)/7).toString()+"px";$("td").css("height",t),$(".td-a1-d2-img").css("height",e),$(".td-a1-d2-img").css("width",e)}$(document).on("click",".img-close-btn",function(t){$(".modal").css("display","none")}),$("#display_total_price").val(dis_total);var delUrl=$("#ic_del").attr("src"),addUrl=$("#ic_add").attr("src"),editUrl=$("#ic_edit").attr("src"),blankUrl=$("#ic_blank").attr("src"),stamp=$("#stamp").attr("src"),profile=$("#profile").attr("src"),logoSrc=$("#logo").attr("src");function make_tr(t,e,a){var i="",s=$("#timg_"+(t-e)).attr("src"),d=$("#title_"+(t-e)).val(),l=$("#price_"+(t-e)).val(),r=$("#quantity_"+(t-e)).val(),c=$("#current_price_"+(t-e)).val();return e<0||a<0||t==a+1&&(s=blankUrl,d="タイトル",c=r=l=0),i+='<tr><td class="td-a1"><div class="td-a1-d1 tooltip"><img src="'+editUrl+'" class="img1"/><div class="tooltiptext"><div><img src="'+delUrl+'" id="del_'+t+'" class="img2 del"/></div><div><img src="'+addUrl+'" id="row_'+t+'" class="img2 row"/></div></div></div>',i+='<div class="flex-center"><img alt="product" id="timg_'+t+'" src="'+s+'" class="td-a1-d2-img" /></div>',i+='<input class="td-a1-input" id="title_'+t+'" value="'+d+'" ></td>',i+='<td><input class="td-a2-input" id="price_'+t+'" value="'+l+'"><span>円</span></td>',i+='<td class="td-a3"><input class="td-a3-input" id="quantity_'+t+'" value="'+r+'"></td>',i+='<td class="td-a4"> <input class="td-a4-input"  id="current_price_'+t+'" value="'+c+'">円</td><tr>'}function make_before(t){var e="",a=$("#cDate").val(),i=$("#uName").val(),s=$("#company").val(),d=$("#invoice").text(),l=parseInt($("#display_total_price").val().replaceAll(",","")),r=$("#zipCode").val(),c=$("#adress").val(),n=$("#phone").val(),p=$("#eDate").val(),o=$("#uMethod").val(),u=$("#purpose_1").val();return e+='<div id="page1" class="page1"><div class="flex-between mb1"><div class="pro33"><img id="logo" src="'+logoSrc+'" style="height:50px;"/></div><div class="pro33 flex-center text-center p2 text-center t6 b8"><input id="purpose_1" class="input10" style="height: 60px;" value="'+u+'"></div><div class="pro33 text-right t1 b2 text-center">発行日:<input id="cDate" class="input2 w125 text-right" value="'+a+'"> </div></div>',e+='<div class="flex mb1"><div class="pro60"><div id="uNameDiv" class="t4 uline-grey pb-1"><input id="uName" class="input9 text-right" value="'+i+'">様</div><div id="uMethodDiv" class="uline-grey pb5 w200 text-left t2"> 支払方法：<input id="uMethod" class="input1 w200" value="'+o+'"></div></div>',e+='<div class="flex-between p2"><div class="p2"><img id="profile" alt="profile" src="'+profile+'" style="border-style:solid; border-width:1px; height:50px; width:50px" /></div>',e+='<div class="t1"><div>請求書.No.Q1002-29-88</div><input id="company" class="input2 w200" value="'+s+'"><div id="invoice">'+d+'</div></div></div></div><div class="flex pro100"><div class="flex-between pro60"><div class="flex-end pb3"><div class="uline-grey pb1"><span class="t1">ご請求金額&nbsp;&nbsp;</span><input class="input4 w250 text-left number-separator" id="display_total_price" value="'+l+'"><span class="t5 b4" style="vertical-align: 3px;">円&nbsp;</span></div></div></div>',e+='<div class="flex-between t1 pro40"><div class="flex-center p2 text-center w150"><p>住所</p></div><div class="flex p2"><div><input id="zipCode" class="input2 w200" value="'+r+'"><input id="adress" class="input2 w200" value="'+c+'"><input id="phone" class="input2 w200" value="'+n+'"></div></div><div class="flex-center p3"><img alt="stamp" id="stamp" src="'+stamp+'" style="height:70px; width:70px" /></div></div></div>',e+='<div><div class="t1"> 有効期間 <input id="eDate" class="input2 w200" value="'+p+'"></div>',e+=make_line_des(t),e+='<div  id="main_table">'}function make_page2_top(){var t=$("#cDate").val(),e=$("#purpose_1").val(),a="";return a+='<div id="page2" class="page2"><div class="flex-between mb1"><div class="pro25"><img id="logo" src="'+logoSrc+'" style="height:50px;"/></div><div class="pro50 flex-center text-center p2 text-center t6 b8"><input id="purpose_2" class="input10" style="height: 60px;" value="'+e+'" readonly></div><div class="pro25 text-right t1 b2 text-center">発行日:<input id="cDate" class="input2 w125 text-right" value="'+t+'"> </div></div>'}function make_page_break(){return'<div style="page-break-after:always"><span style="display:none"></span></div>'}function make_line_des(t){var e="";return e+="2/2"==t?'<hr style="border-top:2px solid blue"><p class="text-center t2">内容明細'+t+"</p>":'<hr style="border-top:2px solid blue"><p class="text-center t2">内容明細'+t+"</p></div>"}function make_html_page(t){var e,a=parseInt($("#rowCount").val()),i=$("#total_count").attr("value"),s=$("#total_price").attr("value"),d=$("#reduce_plus").val(),l="pro8"==$("#reduce_pro").val()?'<select name="pets" id="reduce_pro"><option value="pro8" selected>消費税(8%対象)</option><option value="pro10">消費税(10%対象)</option>':'<select name="pets" id="reduce_pro"><option value="pro8">消費税(8%対象)</option><option value="pro10" selected>消費税(10%対象)</option>',r=($("#reduce_amount").val(),"");if(a<=t){r+=make_before(" ");for(var c='<table cellpadding="1" cellspacing="0" class="main-table"><thead><tr><th class="th1">内容</div></th><th class="th2">単価</div></th><th class="th3">数量</th><th class="th4">金額(円)</th></tr></thead><tbody>',n=0;n<a;n++)c+=make_tr(n,0);c+='<tr><td class="td-r1">合計</td><td ></td><td class="td-r3"><input  class="td-r3-input" id="total_count" value="'+i+'"> </td><td class="td-r4"> <input  class="td-r4-input" id="total_price" value="'+s+'">円</td></tr>',r+=c+='<tr><td class="td-t1" id="reduce_pro_td">'+l+'</td><td ></td><td class="td-t3"></td><td class="td-t4">(内税) <input  class="td-t4-input" id="reduce_plus" value="'+d+'">円</td></tr> </tbody></table>',r+='</div><textarea style="width:100%; height: 100px; border: 1px solid grey; padding: 5px; box-sizing: border-box; margin-top:20px; font-size: 20px;" placeholder="(備考)"></textarea></div>'}else{for(c='<table cellpadding="1" cellspacing="0" class="main-table"><thead><tr><th class="th1">内容</div></th><th class="th2">単価</div></th><th class="th3">数量</th><th class="th4">金額(円)</th></tr></thead><tbody>',n=0;n<t;n++)c+=make_tr(n,0,-1);r+=make_before("1/2"),e=$("#total_price_sub").attr("value"),$("#total_count_sub").attr("value");for(var p="",o="",c='<table cellpadding="1" cellspacing="0" class="main-table">',p=o=c+='<thead><tr><th class="th1">内容</div></th><th class="th2">単価</div></th><th class="th3">数量</th><th class="th4">金額(円)</th></tr></thead><tbody>',n=0;n<a;n++)n<t?p+=make_tr(n,0,-1):o+=make_tr(n,0,-1);o+='<tr><td class="td-r1">合計</td><td ></td><td class="td-r3"><input  class="td-r3-input" id="total_count" value="'+i+'"> </td><td class="td-r4"> <input  class="td-r4-input" id="total_price" value="'+s+'">円</td></tr>',o+='<tr><td class="td-t1" id="reduce_pro_td">'+l+'</td><td ></td><td class="td-t3"> </td><td class="td-t4">(内税) <input  class="td-t4-input" id="reduce_plus" value="'+d+'">円</td></tr> </tbody></table>',r+=p+='<tr><td class="td-r1">小計</td><td ></td><td class="td-r3"><input  class="td-r3-input" id="total_count_sub" value="'+i+'"> </td><td class="td-r4"> <input  class="td-r4-input" id="total_price_sub" value="'+e+'">円</td></tr> </tbody></table>',r+="</div></div>",r+=make_page_break(),r+='<div class="break"></div>',r+=make_page2_top(),r+=make_line_des("2/2"),r+='<div  id="main_table2">',r+=o,r+='</div><textarea style="width:100%; height: 100px; border: 1px solid grey; padding: 5px; box-sizing: border-box; margin-top:20px; font-size: 20px;" placeholder="(備考)"></textarea></div>'}$("#pdf").html(r),$("#current_price_0").change(),$("#quantity_0").change(),$("#rowCount").change(),uDiv(),resize_main_title($("#purpose_1")),resize_main_title($("#purpose_2")),$('[id*="price"]').each(function(){updateTextView($(this))}),updateTextView($("#reduce_plus")),$("#uName").keyup()}$(document).ready(function(){function s(){updateTextView($("#total_price_sub")),updateTextView($("#total_price")),updateTextView($("#reduce_plus"))}$(document).on("click",".del",function(){var t,e=parseInt($(this).attr("id").replaceAll(/del_/g,"")),a=parseInt($("#rowCount").val()),i=parseInt($("#select_resize").val()),s=$("#total_count").attr("value"),d=$("#total_price").attr("value"),l=$("#reduce_plus").val(),r="pro8"==$("#reduce_pro").val()?'<select name="pets" id="reduce_pro"><option value="pro8" selected>消費税(8%対象)</option><option value="pro10">消費税(10%対象)</option>':'<select name="pets" id="reduce_pro"><option value="pro8">消費税(8%対象)</option><option value="pro10" selected>消費税(10%対象)</option>',c=($("#reduce_amount").val(),"");if(a<=i+1){c+=make_before(" ");for(var n='<table cellpadding="1" cellspacing="0" class="main-table"><thead><tr><th class="th1">内容</div></th><th class="th2">単価</div></th><th class="th3">数量</th><th class="th4">金額(円)</th></tr></thead><tbody>',p=0;p<a-1;p++)n+=make_tr(p,p<e?0:-1,e);n+='<tr><td class="td-r1">合計</td><td ></td><td class="td-r3"><input  class="td-r3-input" id="total_count" value="'+s+'"> </td><td class="td-r4"> <input  class="td-r4-input" id="total_price" value="'+d+'">円</td></tr>',c+=n+='<tr><td class="td-t1" id="reduce_pro_td">'+r+'</td><td ></td><td class="td-t3"> </td><td class="td-t4">(内税) <input  class="td-t4-input" id="reduce_plus" value="'+l+'">円</td></tr> </tbody></table>',c+='</div><textarea style="width:100%; height: 100px; border: 1px solid grey; padding: 5px; box-sizing: border-box; margin-top:20px; font-size: 20px;" placeholder="(備考)"></textarea></div>'}else{c+=make_before("1/2"),t=$("#total_price_sub").attr("value"),$("#total_count_sub").attr("value");for(var o="",u="",n='<table cellpadding="1" cellspacing="0" class="main-table">',o=u=n+='<thead><tr><th class="th1">内容</div></th><th class="th2">単価</div></th><th class="th3">数量</th><th class="th4">金額(円)</th></tr></thead><tbody>',p=0;p<a-1;p++)p<i?o+=make_tr(p,p<e?0:-1,e):u+=make_tr(p,p<e?0:-1,e);u+='<tr><td class="td-r1">合計</td><td ></td><td class="td-r3"><input  class="td-r3-input" id="total_count" value="'+s+'"> </td><td class="td-r4"> <input  class="td-r4-input" id="total_price" value="'+d+'">円</td></tr>',u+='<tr><td class="td-t1" id="reduce_pro_td">'+r+'</td><td ></td><td class="td-t3"> </td><td class="td-t4">(内税) <input  class="td-t4-input" id="reduce_plus" value="'+l+'">円</td></tr> </tbody></table>',c+=o+='<tr><td class="td-r1">小計</td><td ></td><td class="td-r3"><input  class="td-r3-input" id="total_count_sub" value="'+s+'"> </td><td class="td-r4"> <input  class="td-r4-input" id="total_price_sub" value="'+t+'">円</td></tr> </tbody></table>',c+="</div></div>",c+=make_page_break(),c+='<div class="break"></div>',c+=make_page2_top(),c+=make_line_des("2/2"),c+='<div  id="main_table2">',c+=u,c+='</div><textarea style="width:100%; height: 100px; border: 1px solid grey; padding: 5px; box-sizing: border-box; margin-top:20px; font-size: 20px;" placeholder="(備考)"></textarea></div>'}$("#pdf").html(c),$("#rowCount").val(a-1),$("#current_price_0").change(),$("#quantity_0").change(),$("#rowCount").change(),css_re(),uDiv(),resize_main_title($("#purpose_1")),resize_main_title($("#purpose_2")),$('[id*="price"]').each(function(){updateTextView($(this))}),updateTextView($("#reduce_plus")),$("#uName").keyup()}),$(document).on("click",".row",function(){var t,e=parseInt($(this).attr("id").replaceAll(/row_/g,"")),a=parseInt($("#rowCount").val()),i=parseInt($("#select_resize").val()),s=$("#total_count").attr("value"),d=$("#total_price").attr("value"),l=$("#reduce_plus").val(),r="pro8"==$("#reduce_pro").val()?'<select name="pets" id="reduce_pro"><option value="pro8" selected>消費税(8%対象)</option><option value="pro10">消費税(10%対象)</option>':'<select name="pets" id="reduce_pro"><option value="pro8">消費税(8%対象)</option><option value="pro10" selected>消費税(10%対象)</option>',c=($("#reduce_amount").val(),"");if(a<=i){c+=make_before(" ");for(var n='<table cellpadding="1" cellspacing="0" class="main-table"><thead><tr><th class="th1">内容</div></th><th class="th2">単価</div></th><th class="th3">数量</th><th class="th4">金額(円)</th></tr></thead><tbody>',p=0;p<=a;p++)n+=make_tr(p,e+1<p?1:0,e);n+='<tr><td class="td-r1">合計</td><td ></td><td class="td-r3"><input  class="td-r3-input" id="total_count" value="'+s+'"> </td><td class="td-r4"> <input  class="td-r4-input" id="total_price" value="'+d+'">円</td></tr>',c+=n+='<tr><td class="td-t1" id="reduce_pro_td">'+r+'</td><td ></td><td class="td-t3"> </td><td class="td-t4">(内税) <input  class="td-t4-input" id="reduce_plus" value="'+l+'">円</td></tr> </tbody></table>',c+='</div><textarea style="width:100%; height: 100px; border: 1px solid grey; padding: 5px; box-sizing: border-box; margin-top:20px; font-size: 20px;" placeholder="(備考)"></textarea></div>'}else{c+=make_before("1/2"),t=$("#total_price_sub").attr("value"),$("#total_count_sub").attr("value");for(var o="",u="",n='<table cellpadding="1" cellspacing="0" class="main-table">',o=u=n+='<thead><tr><th class="th1">内容</div></th><th class="th2">単価</div></th><th class="th3">数量</th><th class="th4">金額(円)</th></tr></thead><tbody>',p=0;p<=a;p++)p<i?o+=make_tr(p,e+1<=p?1:0,e):u+=make_tr(p,e+1<p?1:0,e);u+='<tr><td class="td-r1">合計</td><td ></td><td class="td-r3"><input  class="td-r3-input" id="total_count" value="'+s+'"> </td><td class="td-r4"> <input  class="td-r4-input" id="total_price" value="'+d+'">円</td></tr>',u+='<tr><td class="td-t1" id="reduce_pro_td">'+r+'</td><td ></td><td class="td-t3"></td><td class="td-t4">(内税) <input  class="td-t4-input" id="reduce_plus" value="'+l+'">円</td></tr> </tbody></table>',c+=o+='<tr><td class="td-r1">小計</td><td ></td><td class="td-r3"><input  class="td-r3-input" id="total_count_sub" value="'+s+'"> </td><td class="td-r4"> <input  class="td-r4-input" id="total_price_sub" value="'+t+'">円</td></tr> </tbody></table>',c+="</div></div>",c+=make_page_break(),c+='<div class="break"></div>',c+=make_page2_top(),c+=make_line_des("2/2"),c+='<div  id="main_table2">',c+=u,c+='</div><textarea style="width:100%; height: 100px; border: 1px solid grey; padding: 5px; box-sizing: border-box; margin-top:20px; font-size: 20px;" placeholder="(備考)"></textarea></div>'}$("#pdf").html(c),$("#rowCount").val(a+1),$("#resize_rows").val(a+1),$("#current_price_0").change(),$("#quantity_0").change(),$("#rowCount").change(),css_re(),uDiv(),resize_main_title($("#purpose_1")),resize_main_title($("#purpose_2")),$('[id*="price"]').each(function(){updateTextView($(this))}),updateTextView($("#reduce_plus")),$("#uName").keyup()}),$(document).on("change","#total_price",function(){$("#display_total_price").val(parseInt($(this).val().replaceAll(",",""))),updateTextView($(this)),$("#reduce_pro").change()}),$(document).on("change","#display_total_price",function(){updateTextView($(this))}),$(document).on("keyup","#uName",function(){var t=$(this).val().length;15<t?(dis_width=24*$(this).val().length+10,uNameCss=dis_width,uNameDivCss=dis_width+50,$("#uName").css("font-size",24),$("#uNameDiv").css("width",24)):10<t?(dis_width=26*$(this).val().length+15,uNameCss=dis_width,uNameDivCss=dis_width+55,$("#uName").css("font-size",26),$("#uNameDiv").css("width",26)):(dis_width=28*$(this).val().length+20,uNameCss=dis_width,uNameDivCss=dis_width+60,$("#uName").css("font-size",28),$("#uNameDiv").css("width",28)),$("#uName").css("width",uNameCss),$("#uNameDiv").css("width",uNameDivCss)}),$(document).on("keyup","#uMethod",function(){var t=20*$(this).val().length+20;uMethodDivCss=120+(uMethodCss=t),$("#uMethod").css("width",uMethodCss),$("#uMethodDiv").css("width",uMethodDivCss)}),$(document).on("keyup","#purpose_1",function(){resize_main_title($(this)),$("#purpose_2").val($(this).val()),resize_main_title($("#purpose_2"))}),$(document).on("click","input",function(){$(this).css("background-color","yellow")}),$(document).on("blur","input",function(){$(this).css("background-color","white")}),$(document).on("keyup",'[id*="price"]',function(){var t=$(this);t.val(t.val().replaceAll(/[^0-9,]/g,function(t){return alert('「 "'+t+' " と入力しました。\n\n数字のみを使用してください。」'),""})),updateTextView($(this))}),$(document).on("keyup",'[id*="quantity"]',function(){var t=$(this);t.val(t.val().replaceAll(/[^0-9]/g,function(t){return alert('「 "'+t+' " と入力しました。\n\n数字のみを使用してください。」'),""}))}),$(document).on("change",'[id^="price_"]',function(){$(this).val();var t=$(this).attr("id").replaceAll(/price_/g,"");$("#current_price_"+t).val(parseInt($(this).val().replaceAll(",",""))*$("#quantity_"+t).val()),$("#current_price_"+t).change(),updateTextView($("#current_price_"+t)),s()}),$(document).on("change",'[id^="quantity_"]',function(){var t=parseInt($("#rowCount").val()),e=$(this).attr("id").replaceAll(/quantity_/g,"");$("#current_price_"+e).val($(this).val()*parseInt($("#price_"+e).val().replaceAll(",",""))),$("#current_price_"+e).change(),updateTextView($("#current_price_"+e)),s();var a,i=0;$("[id^='quantity_']").each(function(){i+=parseInt($(this).val())}),$("#total_count").val(i),10<=t&&(a=0,$("#main_table").find('[id^="quantity_"]').each(function(){a+=parseInt($(this).val())}),$("#total_count_sub").val(a)),$("#total_price").change(),$("#display_total_price").change(),s()}),$(document).on("change",'[id^="current_price_"]',function(){var t,e=0,a=parseInt($("#rowCount").val());$("[id^='current_price_']").each(function(){e+=parseInt($(this).val().replaceAll(",",""))}),$("#total_price").val(e),10<=a&&(t=0,$("#main_table").find('[id^="current_price_"]').each(function(){t+=parseInt($(this).val().replaceAll(",",""))}),$("#total_price_sub").val(t)),$("#total_price").change(),$("#display_total_price").change()}),$(document).on("mouseenter",".img1",function(t){$(this).css("opacity","1")}).on("mouseleave",".img1",function(t){$(this).animate({opacity:"0"},1e3)}),$(document).on("mouseenter",".img2",function(t){$(this).css("opacity","1")}).on("mouseleave",".img2",function(t){$(this).animate({opacity:"0.5"},300)}),$(document).on("click","#btn_print",function(){$("#btn_print").css("display","none"),$("#select_resize").css("display","none"),$("#blank").css("display","none"),window.print(),$("#btn_print").css("display","block"),$("#select_resize").css("display","block"),$("#blank").css("display","block")}),$(document).on("change","#reduce_pro",function(){var t="pro8"==$(this).val()?8:10;$("#reduce_plus").val(10*Math.ceil(.01*parseInt($("#total_price").val().replaceAll(",",""))*t/10)),updateTextView($("#reduce_plus"))}),$(document).on("change","#select_resize",function(){resize_in(parseInt($("#select_resize").val()))}),$(document).on("focus","input",function(){$(this).select()}),$(document).on("click","[id^='timg_']",function(){$(".modal").css("display","block"),current_img_index=$(this).attr("id").replaceAll(/timg_/g,"")}),$(document).on("click","#img_upload_img",function(){var t=document.createElement("input");t.type="file",t.onchange=t=>{var e=t.target.files[0],t=new FormData;t.append("file",e);var i=$("#hostUrl").val(),e=i+"/api/v1/client/uploadImg";$.ajax({type:"POST",url:e,data:t,contentType:!1,enctype:"multipart/form-data",cache:!1,processData:!1,success:function(t,e){var a=i+"/public/pdf_img/"+t;$("#img_upload_img").attr("src",a),$("#img_upload_url").val(t)}})},t.click()}),$(document).on("click",".img-upload-link-btn",function(){var t=$(this).parent().find("#img_upload_img").attr("src");$("#"+("timg_"+current_img_index)).attr("src",t),$(".modal").css("display","none")}),$(document).on("click",".img-upload-link-btn-1",function(){var t=$(this).parent().find("#img_upload_url_1").val();$("#"+("timg_"+current_img_index)).attr("src",t),$(".modal").css("display","none")}),$('[id*="price"]').each(function(){updateTextView($(this))}),updateTextView($("#reduce_plus")),$("#uName").keyup()});var modal=document.getElementById("q_modal");function resize_main_title(t){7<$("[id^='purpose_']").val().length?(t.css("font-size","32px"),t.css("width","360px")):(t.css("font-size","40px"),t.css("width","280px"))}window.onclick=function(t){t.target==modal&&(modal.style.display="none")};